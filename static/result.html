<!DOCTYPE html>
<html lang="ja">

<head>
  <title>result</title>
  <meta charset="utf-8">
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" type="text/css" href="hoge.css">
  <link href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c" rel="stylesheet">
  <link href="https://fonts.googleapis.com/earlyaccess/nicomoji.css" rel="stylesheet">
  <script src="./js/libraries.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/parameter.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/profile.js" type="module" charset="utf-8"></script>
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</head>

<body>
  <header>
    <ul class="menu-list">
      <li class="menu-list-item" id="home" onclick="move('index','name')">ãƒ›ãƒ¼ãƒ </li>
      <li class="menu-list-item" id="friend" onclick="move('friend','name')">ãƒ•ãƒ¬ãƒ³ãƒ‰</li>
      <li class="menu-list-item" id="rank" onclick="move('ranking','name')">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</li>
      <li class="menu-list-item" id="mission" onclick="move('mission','name')">ãƒŸãƒƒã‚·ãƒ§ãƒ³</li>
      <li class="menu-list-item" id="log" onclick="move('log','name')">å®Ÿç¸¾</li>
      <li class="menu-list-item" id="setup" onclick="OpenProfile('index')">è¨­å®š</li>
    </ul>
  </header>
  <h1 id="appname">ãƒªã‚¶ãƒ«ãƒˆ</h1>
  <p class="rescom">ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</p>
  <p id="nam" class="rescom"> ã•ã‚“ã®æ¶ˆè²»ã—ãŸã‚«ãƒ­ãƒªãƒ¼</p>
  <!--ã‚«ãƒ­ãƒªãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹-->
  <p id="kalorie" class="rescom"> kcal</p>
  <p id="cnt" class="rescom">ç›®æ¨™é”æˆ å›ç›®ã§ã™ï¼</p>
  <p id="ratio" class="rescom">ã‚ãªãŸã®ãƒãƒƒã‚¹ãƒ«ãƒ¬ãƒ¼ãƒˆï¼š </p>
  <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large"
    data-text="ãã‚“ãƒˆãƒ¬ã—ãŸãœï¼" data-url="https://t2.intern.jigd.info" data-show-count="false">Tweet</a>
</body>
<script type="module">
  import { fetchJSON } from "https://code4sabae.github.io/js/fetchJSON.js";

  window.onload = async () => {
    if (param["name"]) {
      setup.innerHTML = param["name"];
    }
    var name = param["name"];

    var req = { id: name };
    const wt = await fetchJSON("/api/weight", req);
    await fetchJSON("/api/log", req);
    const METs = 3.8;
    const TrainingTime = 0.0008; //ç­‹ãƒˆãƒ¬ä¸€å›ã«ä½•ç§’ã‹ã‹ã‚‹ã‹ï¼Ÿ(Trainingã‹ã‚‰timeæŒã£ã¦æ¥ã‚ŒãŸã‚‰ã„ã„ã­)
    var number = param["number"];
    var kalorie = (METs - 1.0) * wt * TrainingTime * number * 1.05; //æ£®æ°¸å¼ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—

    document.getElementById("kalorie").innerHTML = kalorie.toFixed(2); + "kcal " + "ğŸ‰";
    document.getElementById("nam").innerHTML = name + "ã•ã‚“ã®æ¶ˆè²»ã—ãŸã‚«ãƒ­ãƒªãƒ¼";

    // -> server
    req = { id: name };
    const res = await fetchJSON("/api/result", req);
    document.getElementById("cnt").innerHTML = "ç›®æ¨™é”æˆ" + res + "å›ç›®ã§ã™ï¼";
    req = { id: name, kal: kalorie };
    var ratio = await fetchJSON("/api/ratio", req);
    document.getElementById("ratio").innerHTML = "ã‚ãªãŸã®ãƒãƒƒã‚¹ãƒ«ãƒ¬ãƒ¼ãƒˆï¼š" + ratio.toFixed(2);;

    if(res===1){
      req = { id: name , menu: "fir"};
      await fetchJSON("/api/medal", req);
      Swal.fire({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        icon: 'success',
        title: 'ãƒˆãƒ­ãƒ•ã‚£ãƒ¼ğŸ†ã€Œã¯ã˜ã‚ã¦ã®ç­‹ãƒˆãƒ¬ã€ã‚’ç²å¾—ã—ã¾ã—ãŸï¼',
        timer: 3500,
        timerProgressBar: true,
        onOpen: (get) => {
            get.addEventListener('mouseenter', Swal.stopTimer)
            get.addEventListener('mouseleave', Swal.resumeTimer)
        }
      })
      //Â çµ‚äº†å‡¦ç†
      // .then(function(){
      //   console.log("done");
      // })
    }
  };

  //æ›´æ–°æ¤œçŸ¥
  var hash = decodeURIComponent(location.hash.slice(1));
  if (hash === "reload") {
    move("index", "name");
  }
  else {
    location.hash = "reload";
  }

</script>

</html>