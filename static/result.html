<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>result</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="hoge.css">
    <link href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c" rel="stylesheet">
    <link href="https://fonts.googleapis.com/earlyaccess/nicomoji.css" rel="stylesheet">
  </head>
  <body>
    <p>
      <div class = "calorie">
        <div style ="text-align:center;">
          <br>
          <span>
            <p id="nam">      ã•ã‚“ã®æ¶ˆè²»ã—ãŸã‚«ãƒ­ãƒªãƒ¼</p><br>
            <!--ã‚«ãƒ­ãƒªãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹-->
            <p id="kalorie">0kcal</p><br>
          </span>
          <br>
        </div>
      </div>
      <div style="text-align:center;">
        <span>
          <p id="cnt">ç›®æ¨™é”æˆ   å›ç›®ã§ã™ï¼</p><br>
          <p id="comment">ãŠã¤ã‹ã‚Œã•ã¾<br>
            ã‚ˆããŒã‚“ã°ã‚Šã¾ã—ãŸ(ï½¡`ï½¥Ï‰ï½¥Â´ï½¡)</p>
          <p id="ratio">ã‚ãªãŸã®ãƒãƒƒã‚¹ãƒ«ãƒ¬ãƒ¼ãƒˆï¼š ---------------</p>
        </span>
        <form>
          <!--æˆ»ã‚‹ãƒœã‚¿ãƒ³-->
          <input type="button" onclick="location.href='./index.html'" value="æˆ»ã‚‹ã‚„ã§">
          <br><br>
          <!--ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒœã‚¿ãƒ³ -->
          <input type="button" onclick="location.href='./ranking.html'" value="ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¦‹ã‚‹ã‚„ã§">
        </form>
      </div>
    </p>
  </body>
  <script type="module">
    import { fetchJSON } from "https://code4sabae.github.io/js/fetchJSON.js";

    //æ›´æ–°æ¤œçŸ¥
    var hash = decodeURIComponent(location.hash.slice(1));
    if (hash == "reload") {
      
      location.href = "./index.html";
    }
    else {
      location.hash = "reload";
    }

    //HTMLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®é€£æƒ³é…åˆ—
    let param = new Array();

    //JSONdataã‚’å—ã‘å–ã‚Šã€æˆåŠŸã—ãŸã‚«ã‚¦ãƒ³ãƒˆï¼Ÿ
    window.onload = async () => {
      //ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å—ã‘å–ã£ã¦åˆ†å‰²
      var pair = location.search.substring(1).split('&');
      //é€£æƒ³é…åˆ—ç”Ÿæˆå·¥å ´
      var temp;
      for (let index in pair){
        temp = pair[index].split("=");
        param[temp[0]] = temp[1];
      }
      var number = param["number"];
      var kalorie = number * 10;
      var name = decodeURI(param["name"]);

      document.getElementById("kalorie").innerHTML = "<span id='kcal'>" + kalorie + " " + "</span>" + "kcal" + "<span id='kcal'>" + " ğŸ‰" + "</span>";
      document.getElementById("nam").innerHTML = name + " ã•ã‚“ã®æ¶ˆè²»ã—ãŸã‚«ãƒ­ãƒªãƒ¼";

      // -> server
      var req = { id: name };
      const res = await fetchJSON("/api/result", req);
      document.getElementById("cnt").innerHTML = "ç›®æ¨™é”æˆ "+ res +" å›ç›®ã§ã™ï¼";
      req = { id: name, kal: kalorie };
      var ratio = await fetchJSON("/api/ratio", req);
      document.getElementById("ratio").innerHTML = "ã‚ãªãŸã®ãƒãƒƒã‚¹ãƒ«ãƒ¬ãƒ¼ãƒˆï¼š "+ ratio;
    };

  </script>
</html>
